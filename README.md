# Gpaint
Это консольный графический редактор, поддерживающий массовое изменение изображений, такое как обрезка, размытие, уменьшение шума и т.д.
# Подключение и использование
> Проект рассчитан на Unix-подобные ОС.
## Linux
Для компиляции используется утилита `make` и компилятор `g++`. Склонируйте проект и запустите команду `make` в папке проекта.
Появится исполняемый файл `gpaint`. Если хотите запустить программу вместе с компиляцией, запустите `make run`.
# Инструкция по использованию
Для получения справки используйте `help` или `--help`, Для получения справки по любой команде введите `<command> --help`.

У программы есть два режима работы. То, в каком режиме находится программа, можно определить по цвету заголовка строки.
1) Режим навигации (стоит изначально, зелёный заголовок) используется для выбора директории, внутри которой находятся картинки для работы.
Из него можно перейти в режим редактрования, используя команду `edit <маски>` или введя маску как команду. Маска выбирает файлы для редактирования.
2) Режим редактирования (желтый заголовок) используется для применения фильтров к изображениям, при этом изменить рабочую директорию невозможно.

Ниже приведён пример перехода из режима навигации в режим редактирования и обратно:
![modes](https://github.com/KIrillPal/gpaint/blob/main/images/README_images/modes.jpg)

Здесь мы:
1) `cd` - Переходим из корневой папки исполняемого файла 'gpaint' в папку 'images', 
2) `ls` - смотрим всё содержимое выбранной папки.
3) `edit *.bmp` - входим в режим редактирования для всех bmp файлов по маске `*.bmp`.
4) `status` - смотрим, какие файлы были добавлены и что фильтров ещё не применено.
5) `exit` - выходим из режима редактирования, а второй раз из программы.

В каждом режиме свой набор команд. Рассмотрим список команд для каждого режима.
## 1. Режим навигации (зелёный)
Для работы с изображениями выбирается `рабочая директория(current working directory)`. Сократим до 'cwd'. Она гарантирует, что файлы вне неё не будут изменены. 
В режиме навигации cwd указывается в заголовке строки в формате:

`[<имя пользователя>@<имя компьютера> <cwd>]$`

Этот режим служит для выбора рабочей директории. При переходе к редактированию она фиксируется. При её удалении считается пустой, но не сбрасывается. 

О каждой команде подробно вы можете узнать, используя `<command> --help` или `<command> -h`.

Краткое описание команд:
### 1. ls [directory path]
Выводит список файлов и каталогов, находящихся в указанной директории (или в cwd, если нет аргумента).
### 2. cd \<directory path\>
Переходит в указанную директорию, т.е. изменяет cwd на директорию по аргументу.
### 3. exit || q
Выходит из программы.
### 4. edit [file masks]
Переход в режим редактирования. Аргументы - список масок, которые выделяют нужные файлы для редактирования.
К редактированию принимаются только изображения в формате `bmp`. Никакие действия с памятью не производятся.

**Формат:** edit [file masks]

**Формат:** [file masks] --- можно обойтись без слова edit. Программа распознаёт корректные маски как запрос на редактирование.

Маска - это шаблон для относительного пути bmp файла, который будет найден программой.
Маска может содержать символы '?' - любой символ, '\*' - любая последовательность символов.
Например, маска "folder/i\*e.?mp" соответствует последовательности "folder/image.bmp" или "folder/ie.amp",
но не "fol/image.bmp" или "folder/image.bbmp".
Разрешено использовать в маске шаблоны каталогов, например, "../\*/\*.bmp".

Примеры:
1. "edit ./image.bmp ./folder-\*/?????.bmp"
2. "./image.bmp ./folder-\*/?????.bmp" - можно избежать слова "edit"
3. "edit \*"
4. "edit" - ничего не будет найдено.
5. "~/Desktop/all_files/\*.bmp"
6. "\*"
  
## 2. Режим редактирования (желтый)
Перейдём непосредственно к редактированию изображений. В этом режиме есть два списка:
- Список добавленных изображений. Этот список создаётся при входе в режим командой `edit` и не изменяем. Отображаются полные пути.
- Список примененных фильтров. Изначально пустой. Фильтры непосредственно изменяют изображение.

Посмотреть оба списка в любой момент можно командой `status`, но об этом далее.
Фильтры добавляются соответствующими командами, удаляются командой `undo`. `save` - единственная команда, напрямую взаимодействующая с памятью. 
Она загружает в ОЗУ очередное изображение из первого списка, последовательно применяет к нему все фильтры из второго списка, и сохраняет по правилу, указанному в аргументе `save`.
Очистить список фильтров можно командой `reset`. Для предпоказа выбранных изображений используется `preview`.

О каждой команде или фильтре подробно вы можете узнать, используя `<command> --help` или `<command> -h`.

## Фильтры
Фильтры применяются соответствующими командами.

Для примера возьмём стоковое изображение bmp:

![original](https://github.com/KIrillPal/gpaint/blob/main/images/examples/original.bmp)

Описание фильтров:
### 1. Негатив
Инвертирует цвета в изображении.

**Формат:** negative

![negative](https://github.com/KIrillPal/gpaint/blob/main/images/examples/negative.bmp)
### 2. Выделение границ
Выделяет границы рисунка.

**Формат:** clarify

![clarify](https://github.com/KIrillPal/gpaint/blob/main/images/examples/clarify.bmp)

### 3. Изменение размера
Изменяет размер рисунка.

**Формат:** resize \<size x\> \<size y\> - изменяет размер до (\<size x\>, \<size y\>).
  
Пример: resize 20 30

![resize2030](https://github.com/KIrillPal/gpaint/blob/main/images/examples/resize2030.bmp)
  
### 4. Размытие по Гауссу
Применяет размытие гаусса.

**Формат:** gauss \<dispersion\> [conv matrix size] - размытие Гаусса с дисперсией \<dispersion\> и стороной матрицы свёртки [conv matrix size] пикселей.
По умолчанию \<conv matrix size\> := \<dispersion\> \* 6 + 1.

Пример: gauss 10

![gauss10](https://github.com/KIrillPal/gpaint/blob/main/images/examples/gauss10.bmp)

### 5. Медианный фильтр
Снижает шум изображения.

**Формат:** median

![median](https://github.com/KIrillPal/gpaint/blob/main/images/examples/median.bmp)

### 5. Ч/Б
Делает изображение чёрно-белым.

**Формат:** gray

![gray](https://github.com/KIrillPal/gpaint/blob/main/images/examples/gray.bmp)

### 5. Фильтр Собеля
Вычисляет градиент яркости изображения. Можно сказать, делает рисунок из границ.

**Формат:** sobel

![sobel](https://github.com/KIrillPal/gpaint/blob/main/images/examples/sobel.bmp)


## Применение фильтров.
Вводя фильтры в формате выше мы добавляем их в список для применения.

> Внимание! При добавлении фильтра изображения НЕ ИЗМЕНЯЮТСЯ. Они изменяются только под действием команды `save`.

Когда список фильтров закончен, можно применить их к изображениям. Они применятся ко всем выбранным изображениям сразу. Выбранные изображения - изображения из первого списка.

### save
Команда `save` сохраняет все изображения, применяя к ним последовательно все фильтры. При этом список фильтров не очищается.

**Формат:**
  1)  save
  2)  save [destination image]
  3)  save [destination folder]

1. `save` без аргументов сохраняет изображения в самих себя с фильтрами. При этом попросит подтверждение операции, 
т.к. восстановить изначальные изображения будет уже нельзя.
2. Если выбрано всего одно изображение, аргументом команды можно указать имя нового файла - выбранного изображения с фильтрами. 
Либо папку, в которую сохранится новое изображение с тем же именем.
3. Если выбрано несколько, аргумент команды - папка, куда сохранятся все изменённые изображения. 
Внутри этой папки будет создана система папок, подобная рабочей директории, т.е. если есть "./folder/img.bmp",
то после команды `save ./new_folder/another/` будет создан файл "./new_folder/another/folder/img.bmp".

В случае ошибки на одном изображении на другие это не повлияет. Программа обработает как можно больше изображений.
Если при создании файла такой уже существует, программа попросит подтвердить замену.


## Иные команды
Кратко опишем остальные команды.
### 1. preview [applied image path]
Эта команда помогает посмотреть выбранные изображения прямо в терминале.
Если есть аргумент, выводит в терминал изображение из аргумента.
### 2. reset
Очищает список применяемых фильтров.
### 3. undo [filter name]
Удаляет последний применённый фильтр из списка. Если есть аргумент, удаляет последний фильтр с именем \<filter name\>.
Например `undo gauss` удалит последнее размытие по Гауссу.
### 4. exit || q
Выходит из режима без каких-либо сохранений.
### 5. status
Выводит два списка: выбранные изображения и добавленные фильтры.

## Шаблоны
Шаблон - это файл, содержащий список фильтров в формате, в котором они записываются в теримнал. 
Пример шаблона [pattern1.txt](https://github.com/KIrillPal/gpaint/blob/main/patterns/pattern1.txt).

Для шаблонов есть две команды:
### 1. pat \<pattern's path\>
Загружает шаблон из файла \<pattern's path\>. Фильтры из файла последовательно добавляются в конец списка фильтров.
Шаблон можно добавлять несколько раз.
### 2. spat \<new pattern's path\>
Сохраняет текущий список фильтров в файл шаблона  \<new pattern's path\>. 
Если такой уже существует, предлагает заменить.

# Структура проекта
Здесь описано, какие файлы содержатся в проекте и их предназначение в общих чертах.

## 1. Каталоги
- src - содержит все исходные файлы проекта
- images - содержит bmp изображения для примеров и README
- patterns - содержит сохранённые шаблоны
## 2. src/BMP.cpp и src/BMP.h
Самописные утилиты для работы с BMP форматом. Поддерживает несколько кодировок BMP: 1 байт, 3 байта и 4 байта.
## 3. src/Image.cpp и src/Image.h
Класс Image для работы с картинкой без привязки к формату. Будет использоваться в других проектах.
## 4. src/TerminalParser.cpp и src/TerminalParser.h
Реализация всех основных команд. Здесь расположен флаг режима и основные списки.
Разработчику доступны широкие возможности для кастомизации. Используется во множестве других проектов.
## 5. src/color.h
Самописная вспомогательная структура RGBColor. Нужна для экономного содержания изображения в памяти. 
## 6. src/gpaint_exception.h
Макрос выведения ошибок пользователю.
## 7. src/Helper.cpp
Содержит все тексты команд и аттрибутов `help`, а также функции для их вывода.
## 8. src/Filters
Папка, содержащая реализацию фильтров. Иерархия классов ImageFilter, Convolution и прочих будет добавлена позже.
src/Filters/gpaint_filters.h содержит объявление и настройку фильтров, что обеспечивает удобное их изменение и добавление.
# Замечания
Гарантируется, что программа использует не более чем 12 * H*W памяти, где H*W - размер самого большого обрабатываемого изображения в формате BMP.
# Особенности проекта
Этот проект является учебным для работы с BMP форматом, однако ИМХО может использоваться на практике для массового изменения изображений. Например, одномоментное изменение аватарок всех пользователей или какой-то части.
